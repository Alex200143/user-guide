<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://kubevirt.io/user-guide/virtual_machines/liveness_and_readiness_probes/" />
      <link rel="shortcut icon" href="../../assets/favicon.ico" />
    <title>Liveness and Readiness Probes - KubeVirt User-Guide</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Liveness and Readiness Probes";
        var mkdocs_page_input_path = "virtual_machines/liveness_and_readiness_probes.md";
        var mkdocs_page_url = "/user-guide/virtual_machines/liveness_and_readiness_probes/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> KubeVirt User-Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../quickstarts/">Quickstarts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../release_notes/">KubeVirt release notes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Operations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/updating_and_deletion/">Updating and deletion</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/basic_use/">Basic use</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/customize_components/">Customize components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/api_validation/">API Validation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/debug/">Debug</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/virtctl_client_tool/">virtctl Client Tool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/live_migration/">Live Migration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/hotplug_volumes/">Hotplug Volumes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/snapshot_restore_api/">Snapshot Restore API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/hugepages/">Hugepages support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/component_monitoring/">Component monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/authorization/">Authorization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/annotations_and_labels/">Annotations and labels</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/node_assignment/">Node assignment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/node_maintenance/">Node maintenance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/node_overcommit/">Node overcommit</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/unresponsive_nodes/">Unresponsive nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/containerized_data_importer/">Containerized Data Importer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/activating_feature_gates/">Activating feature gates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/export_api/">Export API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/clone_api/">Clone API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/memory_dump/">Virtual machine memory dump</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/mediated_devices_configuration/">Mediated devices and virtual GPUs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/migration_policies/">Migration Policies</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Virtual machines</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../virtual_machine_instances/">Virtual Machines Instances</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lifecycle/">Lifecycle</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../run_strategies/">Run Strategies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../instancetypes/">Instancetypes and preferences</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../presets/">Presets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../virtual_hardware/">Virtual hardware</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dedicated_cpu_resources/">Dedicated CPU resources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../numa/">NUMA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../disks_and_volumes/">Disks and Volumes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../interfaces_and_networks/">Interfaces and Networks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../istio_service_mesh/">Istio service mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../networkpolicy/">NetworkPolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../host-devices/">Host Devices Assignment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../windows_virtio_drivers/">Windows virtio drivers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guest_operating_system_information/">Guest Operating System Information</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guest_agent_information/">Guest Agent information</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Liveness and Readiness Probes</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#define-a-http-liveness-probe">Define a HTTP Liveness Probe</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#define-a-tcp-liveness-probe">Define a TCP Liveness Probe</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#define-readiness-probes">Define Readiness Probes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dual-stack-considerations">Dual-stack considerations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#defining-a-watchdog">Defining a Watchdog</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#defining-guest-agent-ping-probes">Defining Guest-Agent Ping Probes</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../accessing_virtual_machines/">Accessing Virtual Machines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../startup_scripts/">Startup Scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_objects/">Service objects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../templates/">Templates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tekton_tasks/">KubeVirt Tekton</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../replicaset/">VirtualMachineInstanceReplicaSet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dns/">DNS records</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../boot_from_external_source/">Booting From External Source</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../confidential_computing/">Confidential computing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vsock/">VSOCK</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../web_console/">Web Console</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/contributing/">Contributing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">KubeVirt User-Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Virtual machines &raquo;</li>
      <li>Liveness and Readiness Probes</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/kubevirt/user-guide/edit/main/docs/virtual_machines/liveness_and_readiness_probes.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="liveness-and-readiness-probes">Liveness and Readiness Probes<a class="headerlink" href="#liveness-and-readiness-probes" title="Permanent link">&para;</a></h1>
<p>It is possible to configure Liveness and Readiness Probes in a similar
fashion like it is possible to configure <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Liveness and Readiness Probes
on
Containers</a>.</p>
<p>Liveness Probes will effectively stop the VirtualMachineInstance if they
fail, which will allow higher level controllers, like VirtualMachine or
VirtualMachineInstanceReplicaSet to spawn new instances, which will
hopefully be responsive again.</p>
<p>Readiness Probes are an indicator for Services and Endpoints if the
VirtualMachineInstance is ready to receive traffic from Services. If
Readiness Probes fail, the VirtualMachineInstance will be removed from
the Endpoints which back services until the probe recovers.</p>
<p>Watchdogs focus on ensuring that an Operating System is still responsive. They
complement the probes which are more workload centric. Watchdogs require kernel
support from the guest and additional tooling like the commonly used <code>watchdog</code>
binary.</p>
<p>Exec probes are Liveness or Readiness probes specifically intended for VMs.
These probes run a command inside the VM and determine the VM ready/live state based
on its success.
For running commands inside the VMs, the qemu-guest-agent package is used.
A command supplied to an exec probe will be wrapped by <code>virt-probe</code> in the 
operator and forwarded to the guest.</p>
<h2 id="define-a-http-liveness-probe">Define a HTTP Liveness Probe<a class="headerlink" href="#define-a-http-liveness-probe" title="Permanent link">&para;</a></h2>
<p>The following VirtualMachineInstance configures a HTTP Liveness Probe
via <code>spec.livenessProbe.httpGet</code>, which will query port 1500 of the
VirtualMachineInstance, after an initial delay of 120 seconds. The
VirtualMachineInstance itself installs and runs a minimal HTTP server on
port 1500 via cloud-init.</p>
<pre><code class="language-yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    kubevirt.io/vm: vmi-fedora-vmi
  name: vmi-fedora
spec:
  template:
    metadata:
      labels:
        kubevirt.io/domain: vmi-fedora
        kubevirt.io/vm: vmi-fedora
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
      rng: {}
    resources:
      requests:
        memory: 1024M
  livenessProve:
    initialDelaySeconds: 120
    periodSeconds: 20
    httpGet:
      port: 1500
    timeoutSeconds: 10
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: quay.io/containerdisks/fedora:latest
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        user: fedora
        chpasswd: { expire: False }
        bootcmd:
          - [&quot;sudo&quot;, &quot;dnf&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;nmap-ncat&quot;]
          - [&quot;sudo&quot;, &quot;systemd-run&quot;, &quot;--unit=httpserver&quot;, &quot;nc&quot;, &quot;-klp&quot;, &quot;1500&quot;, &quot;-e&quot;, '/usr/bin/echo -e HTTP/1.1 200 OK\\nContent-Length: 12\\n\\nHello World!']
    name: cloudinitdisk
</code></pre>
<h2 id="define-a-tcp-liveness-probe">Define a TCP Liveness Probe<a class="headerlink" href="#define-a-tcp-liveness-probe" title="Permanent link">&para;</a></h2>
<p>The following VirtualMachineInstance configures a TCP Liveness Probe via
<code>spec.livenessProbe.tcpSocket</code>, which will query port 1500 of the
VirtualMachineInstance, after an initial delay of 120 seconds. The
VirtualMachineInstance itself installs and runs a minimal HTTP server on
port 1500 via cloud-init.</p>
<pre><code class="language-yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    kubevirt.io/vm: vmi-fedora-vmi
  name: vmi-fedora
spec:
  template:
    metadata:
      labels:
        kubevirt.io/domain: vmi-fedora
        kubevirt.io/vm: vmi-fedora
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
      rng: {}
    resources:
      requests:
        memory: 1024M
  livenessProbe:
    initialDelaySeconds: 120
    periodSeconds: 20
    tcpSocket:
      port: 1500
    timeoutSeconds: 10
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: quay.io/containerdisks/fedora:latest
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        user: fedora
        chpasswd: { expire: False }
        bootcmd:
          - [&quot;sudo&quot;, &quot;dnf&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;nmap-ncat&quot;]
          - [&quot;sudo&quot;, &quot;systemd-run&quot;, &quot;--unit=httpserver&quot;, &quot;nc&quot;, &quot;-klp&quot;, &quot;1500&quot;, &quot;-e&quot;, '/usr/bin/echo -e HTTP/1.1 200 OK\\nContent-Length: 12\\n\\nHello World!']
    name: cloudinitdisk
</code></pre>
<h2 id="define-readiness-probes">Define Readiness Probes<a class="headerlink" href="#define-readiness-probes" title="Permanent link">&para;</a></h2>
<p>Readiness Probes are configured in a similar way like liveness probes.
Instead of <code>spec.livenessProbe</code>, <code>spec.readinessProbe</code> needs to be
filled:</p>
<pre><code class="language-yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    kubevirt.io/vm: vmi-fedora-vmi
  name: vmi-fedora
spec:
  template:
    metadata:
      labels:
        kubevirt.io/domain: vmi-fedora
        kubevirt.io/vm: vmi-fedora
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
      rng: {}
    resources:
      requests:
        memory: 1024M
  readinessProbe:
    initialDelaySeconds: 120
    periodSeconds: 20
    timeoutSeconds: 10
    failureThreshold: 3
    successThreshold: 3
    httpGet:
      port: 1500
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: quay.io/containerdisks/fedora:latest
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        user: fedora
        chpasswd: { expire: False }
        bootcmd:
          - [&quot;sudo&quot;, &quot;dnf&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;nmap-ncat&quot;]
          - [&quot;sudo&quot;, &quot;systemd-run&quot;, &quot;--unit=httpserver&quot;, &quot;nc&quot;, &quot;-klp&quot;, &quot;1500&quot;, &quot;-e&quot;, '/usr/bin/echo -e HTTP/1.1 200 OK\\nContent-Length: 12\\n\\nHello World!']
    name: cloudinitdisk
</code></pre>
<p>Note that in the case of Readiness Probes, it is also possible to set a
<code>failureThreshold</code> and a <code>successThreashold</code> to only flip between ready
and non-ready state if the probe succeeded or failed multiple times.</p>
<h2 id="dual-stack-considerations">Dual-stack considerations<a class="headerlink" href="#dual-stack-considerations" title="Permanent link">&para;</a></h2>
<p>Some context is needed to understand the limitations imposed by a dual-stack
network configuration on readiness - or liveness - probes. Users must be
fully aware that a dual-stack configuration is currently only available when
using a masquerade binding type. Furthermore, it must be recalled that
accessing a VM using masquerade binding type is performed via the pod IP
address; in dual-stack mode, both IPv4 and IPv6 addresses can be used to reach
the VM.</p>
<p>Dual-stack networking configurations have a limitation when using HTTP / TCP
probes - you <strong>cannot probe the VMI by its IPv6 address</strong>. The reason for this
is the <code>host</code> field for both the
<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#httpgetaction-v1-core">HTTP</a>
and
<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#tcpsocketaction-v1-core">TCP</a>
probe actions default to the pod's IP address, which is currently always the
IPv4 address.</p>
<p>Since the pod's IP address is not known before creating the VMI, it is not
possible to pre-provision the probe's host field.</p>
<h2 id="defining-a-watchdog">Defining a Watchdog<a class="headerlink" href="#defining-a-watchdog" title="Permanent link">&para;</a></h2>
<p>A watchdog is a more VM centric approach where the responsiveness of the
Operating System is focused on. One can configure the <code>i6300esb</code> watchdog
device:</p>
<pre><code class="language-yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-with-watchdog
  name: vmi-with-watchdog
spec:
  domain:
    devices:
      watchdog:
        name: mywatchdog
        i6300esb:
          action: &quot;poweroff&quot;
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 1024M
  terminationGracePeriodSeconds: 0
  volumes:
  - containerDisk:
      image: quay.io/containerdisks/fedora:latest
    name: containerdisk
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        user: fedora
        chpasswd: { expire: False }
        bootcmd:
          - [&quot;sudo&quot;, &quot;dnf&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;busybox&quot;]
    name: cloudinitdisk
</code></pre>
<p>The example above configures it with the <code>poweroff</code> action. It defines what will
happen if the OS can't respond anymore. Other possible actions are <code>reset</code>
and <code>shutdown</code>. The VM in this example will have the device exposed
as <code>/dev/watchdog</code>. This device can then be used by the <code>watchdog</code>
binary. For example, if root executes this command inside the VM:</p>
<pre><code class="language-bash">sudo busybox watchdog -t 2000ms -T 4000ms /dev/watchdog
</code></pre>
<p>the watchdog will send a heartbeat every two seconds to <code>/dev/watchdog</code> and
after four seconds without a heartbeat the defined action will be executed. In
this case a hard <code>poweroff</code>.</p>
<h2 id="defining-guest-agent-ping-probes">Defining Guest-Agent Ping Probes<a class="headerlink" href="#defining-guest-agent-ping-probes" title="Permanent link">&para;</a></h2>
<p>Guest-Agent probes are based on qemu-guest-agent <code>guest-ping</code>.  This will ping
the guest and return an error if the guest is not up and running.  To easily
define this on VM spec, specify <code>guestAgentPing: {}</code> in VM's 
<code>spec.template.spec.readinessProbe</code>.  <code>virt-controller</code> will translate this 
into a corresponding command wrapped by <code>virt-probe</code>.</p>
<blockquote>
<p>Note: You can only define one of the type of probe, i.e. guest-agent exec 
or ping probes.</p>
</blockquote>
<p><strong>Important:</strong> If the qemu-guest-agent is not installed <strong>and</strong> enabled inside
the VM, the probe will fail.  Many images don't enable the agent by default so
make sure you either run one that does or enable it. </p>
<p>Make sure to provide enough delay and failureThreshold for the VM and the agent
to be online.</p>
<p>In the following example the Fedora image does have qemu-guest-agent available
by default. Nevertheless, in case qemu-guest-agent is not installed, it will be
installed and enabled via cloud-init as shown in the example below.  Also,
cloud-init assigns the proper SELinux context, i.e. virt_qemu_ga_exec_t, to the
<code>/tmp/healthy.txt</code> file.  Otherwise, SELinux will deny the attempts to open the
<code>/tmp/healthy.txt</code> file causing the probe to fail.</p>
<pre><code class="language-yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    kubevirt.io/vm: vmi-guest-probe-vmi
  name: vmi-fedora
spec:
  template:
    metadata:
      labels:
        kubevirt.io/domain: vmi-guest-probe
        kubevirt.io/vm: vmi-guest-probe
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
      rng: {}
    resources:
      requests:
        memory: 1024M
  readinessProbe:
    exec:
      command: [&quot;cat&quot;, &quot;/tmp/healthy.txt&quot;]
    failureThreshold: 10
    initialDelaySeconds: 20
    periodSeconds: 10
    timeoutSeconds: 5
  terminationGracePeriodSeconds: 180
  volumes:
  - name: containerdisk
    containerDisk:
      image: quay.io/containerdisks/fedora
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        user: fedora
        chpasswd: { expire: False }
        packages:
          qemu-guest-agent
        runcmd:
          - [&quot;touch&quot;, &quot;/tmp/healthy.txt&quot;]
          - [&quot;sudo&quot;, &quot;chcon&quot;, &quot;-t&quot;, &quot;virt_qemu_ga_exec_t&quot;, &quot;/tmp/healthy.txt&quot;]
          - [&quot;sudo&quot;, &quot;systemctl&quot;, &quot;enable&quot;, &quot;--now&quot;, &quot;qemu-guest-agent&quot;]
    name: cloudinitdisk
</code></pre>
<p>Note that, in the above example if SELinux is not installed in your container
disk image, the command <code>chcon</code> should be removed from the VM manifest shown
below. Otherwise, the <code>chcon</code>  command will fail.</p>
<p>The <code>.status.ready</code> field will switch to <code>true</code> indicating that probes are
returning successfully:</p>
<pre><code class="language-sh">kubectl wait vmis/vmi-guest-probe --for=condition=Ready --timeout=5m
</code></pre>
<p>Additionally, the following command can be used inside the VM to watch the
incoming qemu-ga commands:</p>
<pre><code class="language-sh">journalctl _COMM=qemu-ga --follow 
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../guest_agent_information/" class="btn btn-neutral float-left" title="Guest Agent information"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../accessing_virtual_machines/" class="btn btn-neutral float-right" title="Accessing Virtual Machines">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/kubevirt/user-guide/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../guest_agent_information/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../accessing_virtual_machines/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
