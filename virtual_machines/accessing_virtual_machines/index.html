<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://kubevirt.io/user-guide/virtual_machines/accessing_virtual_machines/" />
      <link rel="shortcut icon" href="../../assets/favicon.ico" />
    <title>Accessing Virtual Machines - KubeVirt User-Guide</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Accessing Virtual Machines";
        var mkdocs_page_input_path = "virtual_machines/accessing_virtual_machines.md";
        var mkdocs_page_url = "/user-guide/virtual_machines/accessing_virtual_machines/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> KubeVirt User-Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../quickstarts/">Quickstarts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../release_notes/">KubeVirt release notes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Operations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/updating_and_deletion/">Updating and deletion</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/basic_use/">Basic use</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/customize_components/">Customize components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/api_validation/">API Validation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/debug/">Debug</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/virtctl_client_tool/">virtctl Client Tool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/live_migration/">Live Migration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/hotplug_volumes/">Hotplug Volumes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/snapshot_restore_api/">Snapshot Restore API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/hugepages/">Hugepages support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/component_monitoring/">Component monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/authorization/">Authorization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/annotations_and_labels/">Annotations and labels</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/node_assignment/">Node assignment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/node_maintenance/">Node maintenance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/node_overcommit/">Node overcommit</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/unresponsive_nodes/">Unresponsive nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/containerized_data_importer/">Containerized Data Importer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/activating_feature_gates/">Activating feature gates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/export_api/">Export API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/clone_api/">Clone API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/memory_dump/">Virtual machine memory dump</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/mediated_devices_configuration/">Mediated devices and virtual GPUs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operations/migration_policies/">Migration Policies</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Virtual machines</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../virtual_machine_instances/">Virtual Machines Instances</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lifecycle/">Lifecycle</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../run_strategies/">Run Strategies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../instancetypes/">Instancetypes and preferences</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../presets/">Presets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../virtual_hardware/">Virtual hardware</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dedicated_cpu_resources/">Dedicated CPU resources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../numa/">NUMA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../disks_and_volumes/">Disks and Volumes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../interfaces_and_networks/">Interfaces and Networks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../istio_service_mesh/">Istio service mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../networkpolicy/">NetworkPolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../host-devices/">Host Devices Assignment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../windows_virtio_drivers/">Windows virtio drivers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guest_operating_system_information/">Guest Operating System Information</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guest_agent_information/">Guest Agent information</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../liveness_and_readiness_probes/">Liveness and Readiness Probes</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Accessing Virtual Machines</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#graphical-and-serial-console-access">Graphical and Serial Console Access</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ssh-access">SSH Access</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../startup_scripts/">Startup Scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_objects/">Service objects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../templates/">Templates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tekton_tasks/">KubeVirt Tekton</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../replicaset/">VirtualMachineInstanceReplicaSet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dns/">DNS records</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../boot_from_external_source/">Booting From External Source</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../confidential_computing/">Confidential computing</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../web_console/">Web Console</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/contributing/">Contributing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">KubeVirt User-Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Virtual machines &raquo;</li>
      <li>Accessing Virtual Machines</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/kubevirt/user-guide/edit/main/docs/virtual_machines/accessing_virtual_machines.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="accessing-virtual-machines">Accessing Virtual Machines<a class="headerlink" href="#accessing-virtual-machines" title="Permanent link">&para;</a></h1>
<h2 id="graphical-and-serial-console-access">Graphical and Serial Console Access<a class="headerlink" href="#graphical-and-serial-console-access" title="Permanent link">&para;</a></h2>
<p>Once a virtual machine is started you are able to connect to the consoles it
exposes. Usually there are two types of consoles:</p>
<ul>
<li>Serial Console</li>
<li>Graphical Console (VNC)</li>
</ul>
<blockquote>
<p>Note: You need to have <code>virtctl</code>
<a href="../../operations/virtctl_client_tool/">installed</a> to gain
access to the VirtualMachineInstance.</p>
</blockquote>
<h3 id="accessing-the-serial-console">Accessing the Serial Console<a class="headerlink" href="#accessing-the-serial-console" title="Permanent link">&para;</a></h3>
<p>The serial console of a virtual machine can be accessed by using the <code>console</code>
command:</p>
<pre><code class="language-shell">virtctl console testvm
</code></pre>
<h3 id="accessing-the-graphical-console-vnc">Accessing the Graphical Console (VNC)<a class="headerlink" href="#accessing-the-graphical-console-vnc" title="Permanent link">&para;</a></h3>
<p>To access the graphical console of a virtual machine the VNC protocol is
typically used. This requires <code>remote-viewer</code> to be installed. Once the
tool is installed, you can access the graphical console using:</p>
<pre><code class="language-shell">virtctl vnc testvm
</code></pre>
<p>If you only want to open a vnc-proxy without executing the <code>remote-viewer</code>
command, it can be accomplished with:</p>
<pre><code class="language-shell">virtctl vnc --proxy-only testvm
</code></pre>
<p>This would print the port number on your machine where you can manually connect
using any VNC viewer.</p>
<h3 id="debugging-console-access">Debugging console access<a class="headerlink" href="#debugging-console-access" title="Permanent link">&para;</a></h3>
<p>If the connection fails, you can use the <code>-v</code> flag to get more verbose
output from both <code>virtctl</code> and the <code>remote-viewer</code> tool to troubleshoot the
problem.</p>
<pre><code class="language-shell">virtctl vnc testvm -v 4
</code></pre>
<blockquote>
<p><strong>Note:</strong> If you are using virtctl via SSH on a remote machine, you need to
forward the X session to your machine. Look up the -X and -Y flags of <code>ssh</code> if
you are not familiar with that. As an alternative you can proxy the API server
port with SSH to your machine (either direct or in combination
with <code>kubectl proxy</code>).</p>
</blockquote>
<h2 id="ssh-access">SSH Access<a class="headerlink" href="#ssh-access" title="Permanent link">&para;</a></h2>
<p>A common operational pattern used when managing virtual machines is to inject
SSH public keys into the virtual machines at boot. This allows automation tools
(like Ansible) to provision the virtual machine. It also gives operators a way
of gaining secure and passwordless access to a virtual machine.</p>
<p>KubeVirt provides multiple ways to inject SSH public keys into a virtual
machine.</p>
<p>In general, these methods fall into two categories:
 - <a href="./#static-ssh-key-injection-via-cloud-init">Static key injection</a>,
which places keys on the virtual machine the first time it is booted.
 - <a href="./#dynamic-ssh-key-injection-via-qemu-user-agent">Dynamic key injection</a>,
which allows keys to be dynamically updated both at boot and during runtime.</p>
<p>Once a SSH public key is injected into the virtual machine, it can be
accessed via <code>virtctl</code>.</p>
<h3 id="static-ssh-public-key-injection-via-cloud-init">Static SSH public key injection via cloud-init<a class="headerlink" href="#static-ssh-public-key-injection-via-cloud-init" title="Permanent link">&para;</a></h3>
<p>Users creating virtual machines can provide startup scripts to their virtual
machines, allowing multiple customization operations.</p>
<p>One option for injecting public SSH keys into a VM is via
<a href="../startup_scripts/#cloud-init">cloud-init startup script</a>.
However, there are more flexible options available.</p>
<p>The virtual machine's access credential API allows statically injecting SSH
public keys at startup time independently of the cloud-init user data by
placing the SSH public key into a Kubernetes <code>Secret</code>. This allows keeping the
application data in the cloud-init user data separate from the credentials
used to access the virtual machine.</p>
<p>A Kubernetes <code>Secret</code> can be created from an SSH public key like this:</p>
<pre><code class="language-shell"># Place SSH public key into a Secret
kubectl create secret generic my-pub-key --from-file=key1=id_rsa.pub
</code></pre>
<p>The <code>Secret</code> containing the public key is then assigned to a virtual machine
using the access credentials API with the <code>configDrive</code> propagation method.</p>
<p>KubeVirt injects the SSH public key into the virtual machine by using the
generated cloud-init metadata instead of the user data. This separates
the application user data and user credentials.</p>
<blockquote>
<p>Note: The cloud-init <code>userData</code> is not touched.</p>
</blockquote>
<pre><code class="language-shell"># Create a VM referencing the Secret using propagation method configDrive
kubectl create -f - &lt;&lt;EOF
apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: testvm
spec:
  running: true
  template:
    spec:
      domain:
        devices:
          disks:
          - disk:
              bus: virtio
            name: containerdisk
          - disk:
              bus: virtio
            name: cloudinitdisk
          rng: {}
        resources:
          requests:
            memory: 1024M
      terminationGracePeriodSeconds: 0
      accessCredentials:
      - sshPublicKey:
          source:
            secret:
              secretName: my-pub-key
          propagationMethod:
            configDrive: {}
      volumes:
      - containerDisk:
          image: quay.io/containerdisks/fedora:latest
        name: containerdisk
      - cloudInitConfigDrive:
          userData: |-
            #cloud-config
            password: fedora
            chpasswd: { expire: False }
        name: cloudinitdisk
EOF
</code></pre>
<h3 id="dynamic-ssh-public-key-injection-via-qemu-guest-agent">Dynamic SSH public key injection via qemu-guest-agent<a class="headerlink" href="#dynamic-ssh-public-key-injection-via-qemu-guest-agent" title="Permanent link">&para;</a></h3>
<p>KubeVirt supports dynamic injection of SSH public keys at runtime by using
the qemu-guest-agent. This is configured by using the access
credentials API with the <code>qemuGuestAgent</code> propagation method.</p>
<blockquote>
<p>Note: This requires the qemu-guest-agent to be installed within the guest.</p>
<p>Note: When using qemuGuestAgent propagation,
the <code>/home/$USER/.ssh/authorized_keys</code> file will be owned by the guest agent.
Changes to the file not made by the guest agent will be lost.</p>
<p>Note: More information about the motivation behind the access credentials API
can be found in the
<a href="https://github.com/kubevirt/kubevirt/pull/4195">pull request description</a>
that introduced the API.</p>
</blockquote>
<p>In the example below the <code>Secret</code> containing the SSH public key is
attached to the virtual machine via the access credentials API with the
<code>qemuGuestAgent</code> propagation method. This allows updating the contents of
the <code>Secret</code> at any time, which will result in the changes getting applied
to the running virtual machine immediately. The <code>Secret</code> may also contain
multiple SSH public keys.</p>
<pre><code class="language-shell"># Place SSH public key into a secret
kubectl create secret generic my-pub-key --from-file=key1=id_rsa.pub
</code></pre>
<p>Now reference this secret in the <code>VirtualMachine</code> spec with the access
credentials API using
<code>qemuGuestAgent</code> propagation.</p>
<pre><code class="language-shell"># Create a VM referencing the Secret using propagation method qemuGuestAgent
kubectl create -f - &lt;&lt;EOF
apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: testvm
spec:
  running: true
  template:
    spec:
      domain:
        devices:
          disks:
          - disk:
              bus: virtio
            name: containerdisk
          - disk:
              bus: virtio
            name: cloudinitdisk
          rng: {}
        resources:
          requests:
            memory: 1024M
      terminationGracePeriodSeconds: 0
      accessCredentials:
      - sshPublicKey:
          source:
            secret:
              secretName: my-pub-key
          propagationMethod:
            qemuGuestAgent:
              users:
              - fedora
      volumes:
      - containerDisk:
          image: quay.io/containerdisks/fedora:latest
        name: containerdisk
      - cloudInitConfigDrive:
          userData: |-
            #cloud-config
            password: fedora
            chpasswd: { expire: False }
            # Disable SELinux for now, so qemu-guest-agent can write the authorized_keys file
            # The selinux-policy is too restrictive currently, see open bugs:
            #   - https://bugzilla.redhat.com/show_bug.cgi?id=1917024
            #   - https://bugzilla.redhat.com/show_bug.cgi?id=2028762
            #   - https://bugzilla.redhat.com/show_bug.cgi?id=2057310
            bootcmd:
              - setenforce 0
        name: cloudinitdisk
EOF
</code></pre>
<h3 id="accessing-the-vmi-using-virtctl">Accessing the VMI using virtctl<a class="headerlink" href="#accessing-the-vmi-using-virtctl" title="Permanent link">&para;</a></h3>
<p>The user can create a websocket backed network tunnel to a port inside the
instance by using the <code>virtualmachineinstances/portforward</code> subresource of the
<code>VirtualMachineInstance</code>.</p>
<p>One use-case for this subresource is to forward SSH traffic into
the <code>VirtualMachineInstance</code> either from the CLI or a web-UI.</p>
<p>To connect to a <code>VirtualMachineInstance</code> from your local machine, <code>virtctl</code>
provides a lightweight SSH client with the <code>ssh</code> command, that uses port
forwarding. Refer to the command's help for more details.</p>
<pre><code class="language-shell">virtctl ssh
</code></pre>
<p>To transfer files from or to a <code>VirtualMachineInstance</code> <code>virtctl</code> also
provides a lightweight SCP client with the <code>scp</code> command. Its usage is
similar to the <code>ssh</code> command. Refer to the command's help for more details.</p>
<pre><code class="language-shell">virtctl scp
</code></pre>
<h4 id="using-virtctl-as-proxy">Using virtctl as proxy<a class="headerlink" href="#using-virtctl-as-proxy" title="Permanent link">&para;</a></h4>
<p>If you prefer to use your local OpenSSH client, there are two ways of doing
that in combination with virtctl.</p>
<blockquote>
<p>Note: Most of this applies to the <code>virtctl scp</code> command too.</p>
</blockquote>
<ol>
<li>The <code>virtctl ssh</code> command has a <code>--local-ssh</code> option. With this option
   <code>virtctl</code> wraps the local OpenSSH client transparently to the user. The
   executed SSH command can be viewed by increasing the verbosity (<code>-v 3</code>).</li>
</ol>
<pre><code class="language-shell">virtctl ssh --local-ssh -v 3 testvm
</code></pre>
<ol>
<li>The <code>virtctl port-forward</code> command provides an option to tunnel a single
   port to your local stdout/stdin. This allows the command to be used in
   combination with the OpenSSH client's <code>ProxyCommand</code> option.</li>
</ol>
<pre><code class="language-shell">ssh -o 'ProxyCommand=virtctl port-forward --stdio=true vmi/testvm.mynamespace 22' fedora@testvm.mynamespace
</code></pre>
<p>To provide easier access to arbitrary virtual machines you can add the following
lines to your SSH <code>config</code>:</p>
<pre><code>Host vmi/*
   ProxyCommand virtctl port-forward --stdio=true %h %p
Host vm/*
   ProxyCommand virtctl port-forward --stdio=true %h %p
</code></pre>
<p>This allows you to simply call <code>ssh user@vmi/testvmi.mynamespace</code> and your
SSH config and virtctl will do the rest. Using this method it becomes easy
to set up different identities for different namespaces inside your SSH
<code>config</code>.</p>
<p>This feature can also be used with Ansible to automate configuration of virtual
machines running on KubeVirt. You can put the snippet above into its own
file (e.g. <code>~/.ssh/virtctl-proxy-config</code>) and add the following lines to
your <code>.ansible.cfg</code>:</p>
<pre><code>[ssh_connection]
ssh_args = -F ~/.ssh/virtctl-proxy-config
</code></pre>
<p>Note that all port forwarding traffic will be sent over the Kubernetes
control plane. A high amount of connections and traffic can increase
pressure on the API server. If you regularly need a high amount of connections
and traffic consider using a dedicated Kubernetes <code>Service</code> instead.</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Create virtual machine and inject SSH public key as explained above</p>
</li>
<li>
<p>SSH into virtual machine</p>
</li>
</ol>
<pre><code class="language-shell"># Add --local-ssh to transparently use local OpenSSH client
virtctl ssh -i id_rsa fedora@testvm
</code></pre>
<p>or</p>
<pre><code class="language-shell">ssh -o 'ProxyCommand=virtctl port-forward --stdio=true vmi/testvm.mynamespace 22' -i id_rsa fedora@vmi/testvm.mynamespace
</code></pre>
<ol>
<li>SCP file to the virtual machine</li>
</ol>
<pre><code class="language-shell"># Add --local-ssh to transparently use local OpenSSH client
virtctl scp -i id_rsa testfile fedora@testvm:/tmp
</code></pre>
<p>or</p>
<pre><code class="language-shell">scp -o 'ProxyCommand=virtctl port-forward --stdio=true vmi/testvm.mynamespace 22' -i id_rsa testfile fedora@testvm.mynamespace:/tmp
</code></pre>
<h4 id="rbac-permissions-for-consolevncssh-access">RBAC permissions for Console/VNC/SSH access<a class="headerlink" href="#rbac-permissions-for-consolevncssh-access" title="Permanent link">&para;</a></h4>
<h5 id="using-default-rbac-cluster-roles">Using default RBAC cluster roles<a class="headerlink" href="#using-default-rbac-cluster-roles" title="Permanent link">&para;</a></h5>
<p>Every KubeVirt installation starting with version v0.5.1 ships a set of default
RBAC cluster roles that can be used to grant users access to
VirtualMachineInstances.</p>
<p>The <code>kubevirt.io:admin</code> and <code>kubevirt.io:edit</code> cluster roles have console,
VNC and SSH respectively port-forwarding access permissions built into them. By
binding either of these roles to a user, they will have the ability to use
virtctl to access the console, VNC and SSH.</p>
<h5 id="using-custom-rbac-cluster-role">Using custom RBAC cluster role<a class="headerlink" href="#using-custom-rbac-cluster-role" title="Permanent link">&para;</a></h5>
<p>The default KubeVirt cluster roles grant access to more than just the
console, VNC and port-forwarding. The <code>ClusterRole</code> below demonstrates how
to craft a custom role, that only allows access to the console, VNC and
port-forwarding.</p>
<pre><code class="language-yaml">apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: allow-console-vnc-port-forward-access
rules:
  - apiGroups:
      - subresources.kubevirt.io
    resources:
      - virtualmachineinstances/console
      - virtualmachineinstances/vnc
    verbs:
      - get
  - apiGroups:
      - subresources.kubevirt.io
    resources:
      - virtualmachineinstances/portforward
    verbs:
      - update
</code></pre>
<p>When bound with a <code>ClusterRoleBinding</code> the <code>ClusterRole</code> above grants access
to virtual machines across all namespaces.</p>
<p>In order to reduce the scope to a single namespace, bind this <code>ClusterRole</code>
using a <code>RoleBinding</code> that targets a single namespace.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../liveness_and_readiness_probes/" class="btn btn-neutral float-left" title="Liveness and Readiness Probes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../startup_scripts/" class="btn btn-neutral float-right" title="Startup Scripts">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/kubevirt/user-guide/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../liveness_and_readiness_probes/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../startup_scripts/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
